_pyplot()
{
    local cur prev opts
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"
    
    F () {
        if [[ ${prev} == -$1 ]]; then
            cmd="(?<=${1}=\")[^\"]*"
            OLDIFS=$IFS
            IFS=$'\n'
            opts=`grep -P -o ${cmd} ${COMP_WORDS[1]}`
            #sorted_unique_ids=$(echo "${opts[@]}" | tr ' ' '\n' | sort -u | tr '\n' ' ')
            #COMPREPLY=(\"$(compgen -W "${sorted_unique_ids[@]}" -- ${cur})\")
            COMPREPLY=(\"$(compgen -W "${opts}" -- ${cur})\")
            IFS=$OLDIFS
            return 0
        fi
    }
    all=(x y xerr yerr parameter parameter_loc acc select linreg o title size_inch style xticks yticks xlabel ylabel xlim ylim border markersize legend_loc)
    
    label=""
    for i in "${all[@]}"
    do
        F "$i"
        label="$label -$i"
    done
    
    #local cur prev opts
    #COMPREPLY=()
    #cur="${COMP_WORDS[COMP_CWORD]}"
    #prev="${COMP_WORDS[COMP_CWORD-1]}"
    #opts="--help --verbose --version"

    if [[ ${cur} == -* ]]; then
        COMPREPLY=( $(compgen -W "${label}" -- ${cur}) )
        return 0
    fi
    
    if [[ $COMPREPLY == "" ]]; then
        COMPREPLY=( $(compgen -o default -- ${cur}) )
        return 0
    fi
}
complete -F _pyplot pyplot
